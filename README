PyGyro
======

PyGyro is a Python-3 library for parallel gyro-kinetic simulations.


Requirements
============

The following python packages are required:

coverage
h5py
matplotlib
mpi4py
numpy
pytest
scipy

This project requires parallel h5py. The commands to install this are as follows:

```
export CC=mpicc
export HDF5_MPI="ON"
export HDF5_DIR=$HDF5_HOME

pip install --no-binary=h5py h5py
```

On a module based system the following modules must first be loaded:

```
module load impi
module load anaconda/3
module load mpi4py
module load hdf5-mpi
```


Run
===

The pure python code can be run using the command:

python fullSimulation

There are 2 obligatory positional arguments. The first is the end time of the simulation. The second is the maximum real-world runtime.

In addition there are 3 optional arguments:
-f foldername
-c constantsFile
-s saveStep

Either a constants file or a folder containing a constants file must be provided.

Acceleration
============

The code can be run using pure python, using acceleration provided by numba or using acceleration provided by pyccel.

Numba
=====

In order to run pygyro using numba, the numba package must be installed.

The command

```
make numba
```

will compile the code using the numba ahead-of-time compiler.

The code can then be run as previously described for the pure python setup.

Pyccel
======

In order to run pygyro using pyccel, it is not necessary to install pyccel.

The command

```
make pyccel
```

will compile the code which has been generated by pyccel.

The code can then be run as previously described for the pure python setup.

If pyccel is installed and you wish to regenerate the fortran code using it, then the command

```
make pyccel PYCC_GEN=1
```

can be used.

When using the pyccel generated code there are two additional options that can be passed to make. These are `M_OPT=1` if the manually optimised fortran files are to be used and `COMP=intel` if the intel compiler should be used.

These options can all be specified in the makefile. A simple `make` command defaults to `make pyccel PYCC_GEN=0 M_OPT=0 COMP=gnu`.
